name: 'ðŸ§ CodeMie Code Pull Request Review'

on:
  pull_request:
    types:
      - opened
      - reopened
      - synchronize
  issue_comment:
    types:
      - created
  pull_request_review_comment:
    types:
      - created
  pull_request_review:
    types:
      - submitted
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'PR number to review'
        required: true
        type: number

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.ref }}
  cancel-in-progress: true

defaults:
  run:
    shell: bash

permissions:
  contents: read
  id-token: write
  issues: write
  pull-requests: write
  statuses: write

jobs:
  review-pr:
    # Only run for trusted users to prevent abuse
    # For private repos: all users with repo access
    # For public repos: only OWNER, MEMBER, or COLLABORATOR
    if: |
      github.event_name == 'workflow_dispatch' ||
      (
        github.event_name == 'pull_request' &&
        (
          github.event.repository.private == true ||
          contains(fromJSON('["OWNER", "MEMBER", "COLLABORATOR"]'), github.event.pull_request.author_association)
        )
      ) ||
      (
        (
          (
            github.event_name == 'issue_comment' &&
            github.event.issue.pull_request
          ) ||
          github.event_name == 'pull_request_review_comment'
        ) &&
        (contains(github.event.comment.body, '@codemie-review') || contains(github.event.comment.body, '@codemie-ai-review')) &&
        (
          github.event.repository.private == true ||
          contains(fromJSON('["OWNER", "MEMBER", "COLLABORATOR"]'), github.event.comment.author_association)
        )
      ) ||
      (
        github.event_name == 'pull_request_review' &&
        (contains(github.event.review.body, '@codemie-review') || contains(github.event.review.body, '@codemie-ai-review')) &&
        (
          github.event.repository.private == true ||
          contains(fromJSON('["OWNER", "MEMBER", "COLLABORATOR"]'), github.event.review.author_association)
        )
      )

    timeout-minutes: 15
    runs-on: ubuntu-latest
    environment: dev

    steps:
      - name: Checkout PR code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'

      - name: Install CodeMie CLI
        run: npm install -g @codemieai/code

      - name: Install Claude Code
        run: codemie install claude

      - name: Setup GitHub Token
        id: generate_token
        run: |
          # Use PAT_TOKEN if available for enhanced permissions, fallback to GITHUB_TOKEN
          if [[ -n "${{ secrets.PAT_TOKEN }}" ]]; then
            echo "Using PAT_TOKEN for enhanced GitHub API permissions"
            echo "token=${{ secrets.PAT_TOKEN }}" >> $GITHUB_OUTPUT
          else
            echo "Using default GITHUB_TOKEN"
            echo "token=${{ secrets.GITHUB_TOKEN }}" >> $GITHUB_OUTPUT
          fi

      - name: Get PR details (pull_request & workflow_dispatch)
        id: get_pr
        if: github.event_name == 'pull_request' || github.event_name == 'workflow_dispatch'
        env:
          GITHUB_TOKEN: ${{ steps.generate_token.outputs.token }}
          EVENT_NAME: ${{ github.event_name }}
          WORKFLOW_PR_NUMBER: ${{ github.event.inputs.pr_number }}
          PULL_REQUEST_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          set -euo pipefail

          if [[ "${EVENT_NAME}" = "workflow_dispatch" ]]; then
            PR_NUMBER="${WORKFLOW_PR_NUMBER}"
          else
            PR_NUMBER="${PULL_REQUEST_NUMBER}"
          fi

          echo "pr_number=${PR_NUMBER}" >> "${GITHUB_OUTPUT}"

          # Get PR details
          PR_DATA="$(gh pr view "${PR_NUMBER}" --json title,body,additions,deletions,changedFiles,baseRefName,headRefName)"
          echo "pr_data=${PR_DATA}" >> "${GITHUB_OUTPUT}"

          # Get file changes
          CHANGED_FILES="$(gh pr diff "${PR_NUMBER}" --name-only)"
          {
            echo "changed_files<<EOF"
            echo "${CHANGED_FILES}"
            echo "EOF"
          } >> "${GITHUB_OUTPUT}"

      - name: Get PR details (issue_comment & reviews)
        id: get_pr_comment
        if: github.event_name == 'issue_comment' || github.event_name == 'pull_request_review' || github.event_name == 'pull_request_review_comment'
        env:
          GITHUB_TOKEN: ${{ steps.generate_token.outputs.token }}
          COMMENT_BODY: ${{ github.event.comment.body || github.event.review.body }}
          PR_NUMBER: ${{ github.event.issue.number || github.event.pull_request.number }}
        run: |
          set -euo pipefail

          echo "pr_number=${PR_NUMBER}" >> "${GITHUB_OUTPUT}"

          # Extract additional instructions from comment (handle @codemie-review or @codemie-ai-review)
          ADDITIONAL_INSTRUCTIONS="$(
            echo "${COMMENT_BODY}" | sed 's/.*@codemie\(-ai\)\?-review//' | xargs
          )"
          echo "additional_instructions=${ADDITIONAL_INSTRUCTIONS}" >> "${GITHUB_OUTPUT}"

          # Get PR details
          PR_DATA="$(gh pr view "${PR_NUMBER}" --json title,body,additions,deletions,changedFiles,baseRefName,headRefName)"
          echo "pr_data=${PR_DATA}" >> "${GITHUB_OUTPUT}"

          # Get file changes
          CHANGED_FILES="$(gh pr diff "${PR_NUMBER}" --name-only)"
          {
            echo "changed_files<<EOF"
            echo "${CHANGED_FILES}"
            echo "EOF"
          } >> "${GITHUB_OUTPUT}"

      - name: Configure CodeMie Code with MCP
        id: configure_mcp
        env:
          GITHUB_TOKEN: ${{ steps.generate_token.outputs.token }}
        run: |
          # Create CodeMie Code settings directory
          mkdir -p ~/.config/claude-code

          # Create MCP configuration for GitHub integration
          cat > ~/.config/claude-code/settings.json << 'EOF'
          {
            "mcpServers": {
              "github": {
                "command": "npx",
                "args": [
                  "-y",
                  "@modelcontextprotocol/server-github"
                ],
                "env": {
                  "GITHUB_PERSONAL_ACCESS_TOKEN": "$GITHUB_TOKEN"
                }
              }
            }
          }
          EOF

          # Replace the token placeholder with actual token
          sed -i "s|\$GITHUB_TOKEN|${GITHUB_TOKEN}|g" ~/.config/claude-code/settings.json

          echo "âœ… MCP GitHub server configured"
          echo "Configuration location: ~/.config/claude-code/settings.json"

      - name: Verify AWS Credentials
        run: |
          echo "Checking AWS Bedrock credentials..."
          if [ -z "${{ secrets.AWS_REGION }}" ]; then
            echo "âŒ ERROR: AWS_REGION secret is not set"
            exit 1
          fi
          if [ -z "${{ secrets.AWS_ACCESS_KEY_ID }}" ]; then
            echo "âŒ ERROR: AWS_ACCESS_KEY_ID secret is not set"
            exit 1
          fi
          if [ -z "${{ secrets.AWS_SECRET_ACCESS_KEY }}" ]; then
            echo "âŒ ERROR: AWS_SECRET_ACCESS_KEY secret is not set"
            exit 1
          fi
          echo "âœ… All AWS secrets are configured"

      - name: Run CodeMie Code PR Review
        id: claude_review
        env:
          # AWS Bedrock Configuration
          CLAUDE_CODE_USE_BEDROCK: "1"
          AWS_REGION: ${{ secrets.AWS_REGION }}
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: ${{ secrets.AWS_REGION }}
          # GitHub Configuration
          GITHUB_TOKEN: ${{ steps.generate_token.outputs.token }}
          PR_NUMBER: ${{ steps.get_pr.outputs.pr_number || steps.get_pr_comment.outputs.pr_number }}
          PR_DATA: ${{ steps.get_pr.outputs.pr_data || steps.get_pr_comment.outputs.pr_data }}
          CHANGED_FILES: ${{ steps.get_pr.outputs.changed_files || steps.get_pr_comment.outputs.changed_files }}
          ADDITIONAL_INSTRUCTIONS: ${{ steps.get_pr_comment.outputs.additional_instructions }}
          REPOSITORY: ${{ github.repository }}
          # CI Configuration
          CI: "true"
          GITHUB_ACTIONS: "true"
          # Claude Configuration
          MAX_TURNS: ${{ vars.CODEMIE_MAX_TURNS || '50' }}
        run: |
          set -euo pipefail

          # Determine model
          MODEL="${{ secrets.ANTHROPIC_MODEL }}"
          if [ -z "$MODEL" ]; then
            MODEL="anthropic.claude-3-5-sonnet-20241022-v2:0"
          fi

          echo "================================================"
          echo "CodeMie Code PR Review Configuration"
          echo "================================================"
          echo "Repository: ${REPOSITORY}"
          echo "PR Number: ${PR_NUMBER}"
          echo "Model: ${MODEL}"
          echo "AWS Region: ${AWS_REGION}"
          echo "Additional Instructions: ${ADDITIONAL_INSTRUCTIONS:-None}"
          echo "================================================"

          # Create comprehensive review prompt
          cat > /tmp/review-prompt.txt << 'PROMPT_EOF'
          ## Role

          You are a senior staff engineer performing critical code review. Your focus is on identifying
          serious issues that impact system reliability, security, performance, and correctness.
          You have access to GitHub MCP tools to leave comments directly on GitHub.

          ## Core Principle: Quality Over Quantity

          **ONLY comment on issues that are:**
          - ðŸ”´ **Critical**: Must be fixed before merge (security, data corruption, system failure)
          - ðŸŸ  **High**: Should be fixed before merge (bugs, performance issues, breaking changes)
          - ðŸŸ¡ **Medium**: Important quality issues that significantly impact maintainability

          **DO NOT comment on:**
          - âœ… Good code changes (no need to praise)
          - ðŸŸ¢ Minor style issues
          - ðŸŸ¢ Small refactoring suggestions
          - ðŸŸ¢ Documentation improvements (unless critical safety/security docs missing)
          - ðŸ”µ General observations without specific actionable fix

          ## Requirements

          1. All feedback MUST be left on GitHub using MCP tools
          2. Only comment when you identify a REAL problem
          3. Every comment must include a specific fix or suggestion
          4. Focus on issues that genuinely impact code quality, security, or correctness

          ## Steps

          ### 1. Gather Information

          Run these commands to collect PR details:
          ```bash
          echo "${REPOSITORY}"        # Get repository in OWNER/REPO format
          echo "${PR_DATA}"           # Get PR metadata (JSON)
          echo "${CHANGED_FILES}"     # Get list of changed files
          echo "${PR_NUMBER}"         # Get PR number
          echo "${ADDITIONAL_INSTRUCTIONS}"  # Get specific review focus
          gh pr diff "${PR_NUMBER}" --patch  # Get full diff with patches
          ```

          For specific files, use:
          ```bash
          cat filename               # View entire file
          head -50 filename         # View first 50 lines
          tail -50 filename         # View last 50 lines
          grep -n "pattern" filename # Search in file
          ```

          ### 2. Analyze the Changes

          - Understand PR title, description, and intent
          - Review all code changes with focus on critical paths
          - Consider ADDITIONAL_INSTRUCTIONS for focused review areas
          - Scan for high-impact issues first, ignore trivial matters

          ### 3. Review Criteria - CRITICAL & HIGH PRIORITY ONLY

          #### ðŸ”´ Critical Issues (MUST FIX - System/Security Impact)

          **Security Vulnerabilities:**
          - SQL injection, XSS, CSRF, command injection
          - Authentication bypass, authorization flaws
          - Hardcoded secrets, credentials in code
          - Insecure cryptography, weak encryption
          - Path traversal, arbitrary file access
          - Deserialization of untrusted data

          **Data Integrity:**
          - Data corruption risks (race conditions, lost updates)
          - Database transaction issues (missing rollback, isolation problems)
          - Data loss scenarios (missing backups, unsafe deletes)
          - Incorrect data validation leading to corruption

          **System Stability:**
          - Null pointer dereferences causing crashes
          - Memory leaks in long-running processes
          - Resource exhaustion (file handles, connections, memory)
          - Deadlocks and livelocks
          - Infinite loops or recursion

          #### ðŸŸ  High Priority Issues (SHOULD FIX - Correctness/Performance)

          **Logic Errors:**
          - Incorrect business logic implementation
          - Off-by-one errors in loops or arrays
          - Wrong conditional logic (AND vs OR, negation errors)
          - Missing edge case handling
          - Incorrect algorithm implementation

          **Performance Issues:**
          - N+1 query problems
          - O(nÂ²) or worse algorithms where better exists
          - Missing database indexes for queries
          - Unnecessary network calls in loops
          - Memory-intensive operations without bounds

          **Breaking Changes:**
          - API contract changes without versioning
          - Database schema changes without migration
          - Removing public APIs without deprecation
          - Changing function signatures in public interfaces

          **Error Handling:**
          - Swallowed exceptions hiding failures
          - Missing error handling in critical paths
          - Incorrect error propagation
          - Silent failures in important operations

          #### ðŸŸ¡ Medium Priority Issues (IMPORTANT Quality)

          **Maintainability Risks:**
          - Overly complex code (cyclomatic complexity > 15)
          - Significant code duplication (DRY violations)
          - Poor separation of concerns
          - Missing critical comments for complex logic

          **Concurrency Issues:**
          - Missing synchronization in shared state
          - Potential race conditions
          - Improper use of concurrent data structures

          **Data Validation:**
          - Missing input validation on external data
          - Insufficient boundary checks
          - Type coercion issues

          ### 4. Severity Guidelines

          Use ONLY these severity levels:
          - ðŸ”´ **Critical**: IMMEDIATE fix required - security/stability/data loss
          - ðŸŸ  **High**: MUST fix before merge - bugs/performance/breaking changes
          - ðŸŸ¡ **Medium**: SHOULD fix - significant maintainability/quality issues

          **Do not use:**
          - ðŸŸ¢ Low severity (skip these issues)
          - ðŸ”µ Info severity (skip observations)

          ### 5. Review Guidelines - STRICT FILTERING

          **ONLY comment if:**
          - âœ… You found a REAL bug or security issue
          - âœ… The issue will cause actual problems (not hypothetical)
          - âœ… You can provide a SPECIFIC fix
          - âœ… The severity is ðŸ”´ Critical, ðŸŸ  High, or ðŸŸ¡ Medium
          - âœ… The issue is on changed lines (+ or - in diff)

          **NEVER comment on:**
          - âŒ Style issues (formatting, naming, etc.)
          - âŒ "Consider doing X" suggestions without clear problem
          - âŒ Documentation improvements (unless safety-critical)
          - âŒ Test suggestions (unless testing is completely missing)
          - âŒ Refactoring ideas without quality impact
          - âŒ Good code practices ("this is well done")
          - âŒ License headers or copyright notices
          - âŒ Context lines (unchanged code)
          - âŒ Hypothetical issues ("this might cause problems if...")
          - âŒ Questions like "have you considered...?" without a concrete issue

          **Comment Quality Standards:**
          - Be direct: "This causes a SQL injection vulnerability"
          - Provide fix: Show exact code to resolve the issue
          - Explain impact: "This will crash when input is null"
          - Be respectful but firm on critical issues

          ### 6. Code Suggestion Format

          **Critical security issue example:**
          ```
          ðŸ”´ SQL injection vulnerability - user input concatenated directly into query
          ```suggestion
          # Use parameterized query
          cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))
          ```

          **Impact**: Attacker can execute arbitrary SQL commands, steal data, or delete database.
          ```

          **High priority bug example:**
          ```
          ðŸŸ  Null pointer exception when user.profile is None
          ```suggestion
          if user and user.profile:
              return user.profile.email
          return None
          ```

          **Impact**: Application crashes on users without profiles.
          ```

          **Medium priority quality issue example:**
          ```
          ðŸŸ¡ Race condition - multiple threads can modify shared state
          ```suggestion
          with self._lock:
              self._counter += 1
              return self._counter
          ```

          **Impact**: Counter can be incorrect under concurrent load, causing data inconsistency.
          ```

          ### 7. Post Review to GitHub

          Use MCP GitHub tools in this order:

          **Step 1: Create pending review**
          ```
          mcp__github__create_pending_pull_request_review
          - owner: {owner}
          - repo: {repo}
          - pull_number: {pr_number}
          ```

          **Step 2: Add inline comments** (repeat for each issue)
          ```
          mcp__github__add_comment_to_pending_review
          - owner: {owner}
          - repo: {repo}
          - pull_number: {pr_number}
          - body: "ðŸŸ¡ Issue description with code suggestion"
          - path: "path/to/file.py"
          - line: {line_number}
          - side: "RIGHT"  # or "LEFT" for old code
          ```

          **Step 3: Submit review with summary**
          ```
          mcp__github__submit_pending_pull_request_review
          - owner: {owner}
          - repo: {repo}
          - pull_number: {pr_number}
          - event: "COMMENT"  # Use "REQUEST_CHANGES" only for critical issues
          - body: "## ðŸ“‹ Review Summary\n\n{summary}"
          ```

          ### 8. Review Summary Format

          **IMPORTANT**: Only create summary if you found issues. If no critical/high/medium issues found, submit an empty review or just say "No critical issues found."

          **If issues were found**, structure your summary:

          ```markdown
          ## ðŸ“‹ Review Summary

          Found {total_count} issues requiring attention before merge.

          ## ðŸ” Issues Found

          - ðŸ”´ Critical: {count} - MUST fix immediately
          - ðŸŸ  High: {count} - Should fix before merge
          - ðŸŸ¡ Medium: {count} - Important for code quality

          ## ðŸŽ¯ Required Actions

          ### Critical Issues (Fix First)
          1. [Brief description of critical issue 1]
          2. [Brief description of critical issue 2]

          ### High Priority (Fix Before Merge)
          1. [Brief description of high issue 1]
          2. [Brief description of high issue 2]

          ### Medium Priority (Should Address)
          1. [Brief description of medium issue 1]

          ## âš ï¸ Review Notes

          - All issues have inline comments with specific fixes
          - Focus on critical and high-priority items first
          - Review inline suggestions for exact code changes
          ```

          **If NO issues found:**
          ```markdown
          ## âœ… Review Complete

          No critical, high, or medium priority issues found. Changes look good from a security, correctness, and quality perspective.
          ```

          ## Context

          The PR changes are provided in unified diff format:

          ```
          FILE: path/to/file.py
          DIFF:
          @@ -10,7 +10,9 @@ def foo():
          -    old_code = 1
          +    new_code = 2
          +    additional_line = 3
          ```

          Line numbers in diff:
          - LEFT side: old code (before changes) - use for comments on deleted code
          - RIGHT side: new code (after changes) - use for comments on added code

          ## Critical Reminders - READ CAREFULLY

          **FILTERING RULES (MOST IMPORTANT):**
          1. â— ONLY comment if severity is ðŸ”´ Critical, ðŸŸ  High, or ðŸŸ¡ Medium
          2. â— SKIP all low-severity and informational comments
          3. â— SKIP all style, formatting, and documentation suggestions
          4. â— SKIP praise and positive observations
          5. â— Every comment MUST identify a real problem with actual impact

          **QUALITY OVER QUANTITY:**
          - Better to have 3 critical comments than 20 trivial ones
          - Each comment must be worth the PR author's time
          - If no serious issues found, say so briefly and approve

          **TECHNICAL REQUIREMENTS:**
          1. Use MCP GitHub tools - no other output reaches PR author
          2. Comment only on changed lines (+ or - in diff)
          3. Include specific code fix in every comment
          4. Explain the real-world impact of each issue
          5. Pay attention to line numbers accuracy

          ## Begin Review

          1. Gather PR information using the commands above
          2. Scan for CRITICAL issues first (security, crashes, data loss)
          3. Then look for HIGH issues (bugs, performance, breaking changes)
          4. Then check for MEDIUM issues (significant quality problems)
          5. IGNORE everything else
          6. Post review with only the important findings

          Remember: A PR with no comments is better than a PR with 15 nitpicks.
          PROMPT_EOF

          echo "Starting CodeMie Code PR review..."
          echo ""

          # Run CodeMie Code with MCP GitHub integration
          timeout 15m claude \
            -p "$(cat /tmp/review-prompt.txt)" \
            --model "${MODEL}" \
            --max-turns "${MAX_TURNS}" \
            --dangerously-skip-permissions \
            --allowedTools "Bash(*),Read(*),mcp__github__*" \
            --debug \
            2>&1 | tee /tmp/codemie-review-output.log || {
              EXIT_CODE=$?
              echo "CodeMie Code exited with code: ${EXIT_CODE}"
              if [ ${EXIT_CODE} -eq 124 ]; then
                echo "Error: CodeMie Code review timed out after 15 minutes"
                exit 1
              fi
              echo "=== Last 100 lines of output ==="
              tail -n 100 /tmp/codemie-review-output.log
              exit ${EXIT_CODE}
            }

          echo "âœ… CodeMie Code PR review completed"

      - name: Upload Review Output
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: codemie-review-output-${{ github.run_number }}
          path: /tmp/codemie-review-output.log
          retention-days: 30

      - name: Post failure comment
        if: failure() && steps.claude_review.outcome == 'failure'
        uses: actions/github-script@v7
        with:
          github-token: ${{ steps.generate_token.outputs.token }}
          script: |
            const prNumber = ${{ steps.get_pr.outputs.pr_number || steps.get_pr_comment.outputs.pr_number }};
            const runUrl = '${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}';

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: `âš ï¸ **CodeMie Code PR Review Failed**

              There was an issue running the automated code review. Please check the [workflow logs](${runUrl}) for details.

              Common issues:
              - AWS Bedrock credentials not configured
              - GitHub token permissions insufficient
              - Review timeout (complex PRs may need manual review)

              You can retry by:
              - Re-running the failed workflow
              - Commenting \`@codemie-review\` with specific focus areas
              - Running manually: \`Actions â†’ CodeMie Code Pull Request Review â†’ Run workflow\``
            });

      - name: Post Summary
        if: always()
        run: |
          echo "## ðŸ§ CodeMie Code PR Review Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Repository**: ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "**PR Number**: ${{ steps.get_pr.outputs.pr_number || steps.get_pr_comment.outputs.pr_number }}" >> $GITHUB_STEP_SUMMARY
          echo "**Status**: ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          echo "### ðŸ”§ Configuration" >> $GITHUB_STEP_SUMMARY
          echo "- **Provider**: AWS Bedrock" >> $GITHUB_STEP_SUMMARY
          echo "- **Model**: ${{ secrets.ANTHROPIC_MODEL || 'anthropic.claude-3-5-sonnet-20241022-v2:0 (default)' }}" >> $GITHUB_STEP_SUMMARY
          echo "- **MCP Integration**: GitHub (enabled)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          echo "### ðŸ“¦ Outputs" >> $GITHUB_STEP_SUMMARY
          echo "- **Review Posted**: Check PR comments for detailed feedback" >> $GITHUB_STEP_SUMMARY
          echo "- **Full Log**: Available in workflow artifacts" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          echo "### ðŸ’¡ Usage Tips" >> $GITHUB_STEP_SUMMARY
          echo "- Comment \`@codemie-review focus on security\` for targeted reviews" >> $GITHUB_STEP_SUMMARY
          echo "- Comment \`@codemie-review check performance\` to focus on optimization" >> $GITHUB_STEP_SUMMARY
          echo "- Review runs automatically on PR open/update (for trusted users)" >> $GITHUB_STEP_SUMMARY
